# ðŸ”® Quantum Pi Forge - Production Deployment Setup

## Overview

This guide covers the complete setup process for deploying the Quantum Pi Forge application to production. The application consists of:

- **Frontend**: Next.js 14 application deployed on Vercel
- **Backend**: FastAPI application deployed on Render
- **Database**: Supabase PostgreSQL database
- **CI/CD**: GitHub Actions for automated deployments

## Prerequisites

Before starting, ensure you have:

1. **GitHub Account** with repository access
2. **Vercel Account** for frontend deployment
3. **Render Account** for backend deployment
4. **Supabase Account** for database hosting
5. **API Keys** from various services (see below)

## Required API Keys & Services

### Core Services
- **Vercel**: Deployment platform
- **Render**: Backend hosting
- **Supabase**: Database and authentication
- **GitHub**: Version control and OAuth

### AI Services
- **OpenAI**: GPT models for AI features
- **Anthropic**: Claude models for AI features
- **xAI**: Grok models for AI features

### Blockchain & Web3
- **Pi Network**: Pi blockchain integration
- **Polygon**: EVM blockchain RPC
- **0G**: Additional blockchain network

### Storage & Data
- **IPFS**: Decentralized file storage
- **Arweave**: Permanent data storage
- **The Graph**: Blockchain data indexing
- **Chainlink**: Oracle services

## Quick Setup Script

Run the automated setup script to generate all required commands:

```bash
./scripts/setup-secrets.sh
```

This script will generate setup commands for:
- Vercel environment variables
- GitHub repository secrets
- Render environment variables
- Supabase configuration
- Local development setup

## Manual Setup Steps

### 1. Vercel Deployment Setup

1. **Connect Repository**:
   ```bash
   vercel link
   ```

2. **Set Environment Variables**:
   Run the commands generated by the setup script, or manually set:

   ```bash
   # Core Configuration
   vercel env add NEXTAUTH_SECRET production
   vercel env add NEXTAUTH_URL production
   vercel env add NEXT_PUBLIC_APP_URL production

   # Database
   vercel env add SUPABASE_URL production
   vercel env add NEXT_PUBLIC_SUPABASE_URL production
   vercel env add NEXT_PUBLIC_SUPABASE_ANON_KEY production

   # AI Services
   vercel env add OPENAI_API_KEY production
   vercel env add ANTHROPIC_API_KEY production
   vercel env add XAI_API_KEY production

   # Pi Network
   vercel env add PI_NETWORK_API_KEY production
   vercel env add PI_NETWORK_APP_ID production
   vercel env add PI_NETWORK_WALLET_PRIVATE_KEY production

   # Blockchain
   vercel env add POLYGON_RPC_URL production
   vercel env add SPONSOR_PRIVATE_KEY production
   vercel env add OINIO_TOKEN_ADDRESS production
   ```

3. **Deploy**:
   ```bash
   vercel --prod
   ```

### 2. Render Backend Setup

1. **Create Render Service**:
   - Go to Render Dashboard
   - Create new "Web Service"
   - Connect your GitHub repository
   - Set build command: `pip install -r requirements.txt`
   - Set start command: `uvicorn main:app --host 0.0.0.0 --port $PORT`

2. **Set Environment Variables** in Render Dashboard:

   ```
   SUPABASE_URL=https://your-project.supabase.co
   SUPABASE_KEY=your_service_role_key
   OPENAI_API_KEY=your_openai_key
   PI_NETWORK_API_KEY=your_pi_key
   # ... (see render.yaml for complete list)
   ```

### 3. Supabase Database Setup

1. **Create Project**:
   ```bash
   supabase init
   supabase start  # For local development
   ```

2. **Run Migrations**:
   ```bash
   supabase db push
   ```

3. **Configure Authentication**:
   - Enable email authentication
   - Set up OAuth providers (GitHub, etc.)
   - Configure Row Level Security policies

### 4. GitHub Secrets Setup

Set repository secrets for CI/CD:

```bash
# Vercel
gh secret set VERCEL_TOKEN
gh secret set VERCEL_ORG_ID
gh secret set VERCEL_PROJECT_ID

# Supabase
gh secret set SUPABASE_ACCESS_TOKEN
gh secret set SUPABASE_PROJECT_REF

# Render
gh secret set RENDER_API_KEY
gh secret set RENDER_SERVICE_ID

# API Keys
gh secret set OPENAI_API_KEY
gh secret set ANTHROPIC_API_KEY
gh secret set PI_NETWORK_API_KEY
# ... (see setup script for complete list)
```

## Environment Variables Reference

### Production URLs
```
NEXT_PUBLIC_APP_URL=https://quantum-pi-forge.vercel.app
NEXT_PUBLIC_BACKEND_URL=https://quantum-pi-forge-backend.onrender.com
```

### Database Configuration
```
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_KEY=your_service_role_key
DATABASE_URL=postgresql://user:pass@host:5432/db
```

### Security
```
NEXTAUTH_SECRET=your_nextauth_secret
JWT_SECRET=your_jwt_secret
ENCRYPTION_KEY=32_character_key
```

### AI Services
```
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...
XAI_API_KEY=xai-...
```

### Pi Network
```
PI_NETWORK_API_KEY=your_pi_api_key
PI_NETWORK_APP_ID=your_pi_app_id
PI_NETWORK_WALLET_PRIVATE_KEY=your_wallet_key
PI_NETWORK_MODE=mainnet
```

### Blockchain
```
POLYGON_RPC_URL=https://polygon-rpc.com
SPONSOR_PRIVATE_KEY=your_sponsor_key
OINIO_TOKEN_ADDRESS=0x07f43E5B1A8a0928B364E40d5885f81A543B05C7
```

## Deployment Verification

### Frontend (Vercel)
1. Check deployment status: `vercel ls`
2. View live site: `vercel open`
3. Check build logs: Vercel dashboard

### Backend (Render)
1. Check service status in Render dashboard
2. View logs in Render dashboard
3. Test API endpoints: `curl https://your-backend.onrender.com/health`

### Database (Supabase)
1. Check Supabase dashboard
2. Run migrations: `supabase db push`
3. Verify tables and policies

## CI/CD Workflows

The following GitHub Actions workflows are configured:

- **Vercel Deploy** (`.github/workflows/vercel-deploy.yml`): Deploys frontend on push to main
- **Render Deploy** (`.github/workflows/render-deploy.yml`): Deploys backend on changes to fastapi/
- **Supabase Migrate** (`.github/workflows/supabase-migrate.yml`): Runs database migrations

## Troubleshooting

### Common Issues

1. **Build Failures**:
   - Check environment variables are set correctly
   - Verify API keys are valid
   - Check build logs for specific errors

2. **Database Connection Issues**:
   - Verify Supabase URL and keys
   - Check Row Level Security policies
   - Ensure migrations have run

3. **API Key Issues**:
   - Verify keys are not expired
   - Check rate limits
   - Ensure correct permissions

4. **Deployment Timeouts**:
   - Check Render service configuration
   - Verify build/start commands
   - Check resource allocation

### Logs and Monitoring

- **Vercel**: Dashboard â†’ Functions/Edge Functions
- **Render**: Dashboard â†’ Service â†’ Logs tab
- **Supabase**: Dashboard â†’ Logs section
- **GitHub Actions**: Repository â†’ Actions tab

## Security Considerations

1. **Never commit secrets** to version control
2. **Use environment-specific keys** (dev/prod)
3. **Rotate keys regularly**
4. **Monitor API usage** for anomalies
5. **Enable 2FA** on all service accounts

## Support

For issues or questions:
1. Check this README first
2. Review GitHub Issues
3. Check service-specific documentation
4. Contact the development team

## Next Steps

After successful deployment:
1. Set up monitoring and alerting
2. Configure domain and SSL certificates
3. Set up backup procedures
4. Plan for scaling and performance optimization
5. Implement comprehensive testing suite

---

*This setup ensures a secure, scalable, and maintainable production deployment of the Quantum Pi Forge application.*