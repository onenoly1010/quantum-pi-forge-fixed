# Railway Configuration for Quantum Pi Forge Backend API
# Docs: https://docs.railway.app/deploy/config-as-code

[build]
builder = "NIXPACKS"
watchPatterns = ["backend/**"]

[deploy]
startCommand = "npm start"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

[build.env]
NODE_ENV = "production"

[deploy.healthcheck]
path = "/api/health"
timeout = 10
interval = 30

[deploy.scaling]
minInstances = 1
maxInstances = 10

# Service configuration
[[service]]
name = "quantum-pi-forge-api"
type = "web"

[service.port]
internal = 3001
external = 443

[service.envVars]
# Public environment variables
NODE_ENV = "production"
PORT = "3001"
API_VERSION = "v1"
CORS_ORIGIN = "https://quantumpiforge.com,https://www.quantumpiforge.com"

# Rate limiting
RATE_LIMIT_WINDOW_MS = "900000"  # 15 minutes
RATE_LIMIT_MAX_REQUESTS = "100"

# Monitoring
ENABLE_REQUEST_LOGGING = "true"
LOG_LEVEL = "info"

# Private environment variables (set in Railway dashboard)
# SPONSOR_PRIVATE_KEY - Wallet private key for gasless transactions
# POLYGON_RPC_URL - Polygon network RPC endpoint
# OINIO_TOKEN_ADDRESS - OINIO token contract address
# DATABASE_URL - PostgreSQL connection string (if using database)
# OPENAI_API_KEY - OpenAI API key for AI features
# SENTRY_DSN - Sentry error tracking DSN

[service.domains]
# Custom domain configuration
[[service.domains.custom]]
domain = "api.quantumpiforge.com"

# Health check configuration
[service.healthcheck]
path = "/api/health"
initialDelaySeconds = 30
periodSeconds = 30
timeoutSeconds = 10
successThreshold = 1
failureThreshold = 3

# Resource limits
[service.resources]
memoryLimit = "512Mi"
cpuLimit = "500m"

# Auto-scaling triggers
[service.autoscaling]
enabled = true
minReplicas = 1
maxReplicas = 5
targetCPUUtilizationPercentage = 70
targetMemoryUtilizationPercentage = 80
